<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Punch Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { padding: 2rem; background: #f8f9fa; }
        .btn-lg { width: 180px; height: 60px; font-size: 1.3rem; margin: 0.5rem; }
        #graph-container { margin-top: 2rem; }
    </style>
</head>
<body>
<div class="container text-center">
    <h1 class="mb-4">Punch Tracker</h1>

    <div class="d-flex justify-content-center">
        <form action="/start" method="post">
            <button type="submit" class="btn btn-success btn-lg">Start Workout</button>
        </form>
        <form action="/stop" method="post">
            <button type="submit" class="btn btn-danger btn-lg">Stop Workout</button>
        </form>
    </div>

    <h3 class="mt-5">Workout Sessions</h3>
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Session ID</th>
                </tr>
            </thead>
            <tbody>
                {% for session in sessions %}
                <tr style="cursor:pointer;" onclick="loadSession('{{ session.id }}')">
                    <td>{{ session.start_time }}</td>
                    <td>{{ session.end_time or 'Active' }}</td>
                    <td>{{ session.id }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="graph-container" class="mt-4">
        <p>Select a session to view its graph.</p>
    </div>
</div>

<script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.6.0.min.js"></script>
<script>
async function loadSession(id) {
    const container = document.getElementById('graph-container');
    container.innerHTML = '<p class="text-muted">Loading...</p>';
    const res = await fetch(`/session/${id}`);
    const plotJSON = await res.json();
    container.innerHTML = "";  // clear old graph
    Bokeh.embed.embed_item(plotJSON, "graph-container");
}
</script>

</body>
</html>
